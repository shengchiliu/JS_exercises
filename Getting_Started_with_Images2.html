<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Image Read and Show Example</title>
<link href="css/js_example_style.css" rel="stylesheet" type="text/css" />
<script src="./js/opencv.js" type="text/javascript"></script>
</head>
<body>
<h2>Image Read and Show Example</h2>
<p>
&lt;canvas&gt; elements named <b>canvasInput</b> and <b>canvasOutput</b> have been prepared.<br>
Click <b>Try it</b> button to see the result. You can choose another image.<br>
You can change the code in the &lt;textarea&gt; to investigate more.
</p>
<div>
<div class="control"><button id="tryIt">Try it</button></div>
<textarea class="code" rows="8" cols="80" id="codeEditor" spellcheck="false">
</textarea>
<p class="err" id="errorMessage"></p>
</div>
<div>
<table cellpadding="0" cellspacing="0" width="0" border="0">
<tr>
<td>
<canvas id="canvasInput"></canvas>
</td>
<td>
<canvas id="canvasOutput"></canvas>
</td>
</tr>
<tr>
<td>
<div class="caption">canvasInput <input type="file" id="fileInput" name="file" accept="image/*" /></div>
</td>
<td>
<div class="caption">canvasOutput</div>
</td>
</tr>
</table>
</div>

<!-- <script src="utils.js" type="text/javascript"></script>
<script id="codeSnippet" type="text/code-snippet">
let src = cv.imread('canvasInput');
let dst = new cv.Mat();
// To distinguish the input and output, we graying the image.
// You can try different conversions.
cv.cvtColor(src, dst, cv.COLOR_RGBA2GRAY);
cv.imshow('canvasOutput', dst);
src.delete();
dst.delete();
</script> -->


<script type="text/javascript">
// let utils = new Utils('errorMessage');               // declare Utils
// utils.loadCode('codeSnippet', 'codeEditor');         // put code into textarea

// this.loadCode = function(scriptId, textAreaId) {
//     let scriptNode = document.getElementById(scriptId);
//     let textArea = document.getElementById(textAreaId);
//     if (scriptNode.type !== 'text/code-snippet') {
//         throw Error('Unknown code snippet type');
//     }
//     textArea.value = scriptNode.text.replace(/^\n/, '');
// };


// utils.loadImageToCanvas('lena.jpg', 'canvasInput');
// this.loadImageToCanvas = function(url, cavansId) {
let canvas = document.getElementById('canvasInput');      // load image to canvas
let ctx = canvas.getContext('2d');
let img = new Image();
img.crossOrigin = 'anonymous';
img.onload = function() {
    canvas.width = img.width;
    canvas.height = img.height;
    ctx.drawImage(img, 0, 0, img.width, img.height);
};
img.src = 'img/ai.jpg';
// };


// utils.addFileInputHandler('fileInput', 'canvasInput');
// this.addFileInputHandler = function(fileInputId, canvasId) {
//     let inputElement = document.getElementById(canvasInput);
//     inputElement.addEventListener('change', (e) => {
//         let files = e.target.files;
//         if (files.length > 0) {
//             let imgUrl = URL.createObjectURL(files[0]);
//             self.loadImageToCanvas(imgUrl, canvasId);
//         }
//     }, false);
// // };


// Declare Canvas2
let canvas2 = document.getElementById('canvasOutputId');
let ctx2 = canvas.getContext('2d');

ctx2.clearRect(0, 0, canvas.width, canvas.height);
canvas.width = img.width;
canvas.height = img.height;
// ctx2.putImageData(img, 0, 0);



let tryIt = document.getElementById('tryIt');
tryIt.addEventListener('click', () => {
    // utils.executeCode('codeEditor');

    


    
    let src = cv.imread('canvasInput');
    let dst = new cv.Mat();
    cv.cvtColor(src, dst, cv.COLOR_RGBA2GRAY);
    cv.imshow('canvasOutput', dst);
    src.delete();
    dst.delete();


    // let img2 = cv.imread('canvasInput');
    // cv.imshow('canvasOutput', img2);
    // img2.delete();

});

// utils.loadOpenCv(() => {
//     tryIt.removeAttribute('disabled');
// });

// this.loadOpenCv = function(onloadCallback) {
//     let script = document.createElement('script');
//     script.setAttribute('async', '');
//     script.setAttribute('type', 'text/javascript');
//     script.addEventListener('load', () => {
//         console.log(cv.getBuildInformation());
//         onloadCallback();
//     });
//     script.addEventListener('error', () => {
//         self.printError('Failed to load ' + OPENCV_URL);
//     });
//     script.src = OPENCV_URL;
//     let node = document.getElementsByTagName('script')[0];
//     node.parentNode.insertBefore(script, node);
// };

</script>
</body>
</html>
